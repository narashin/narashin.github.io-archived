(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{378:function(t,a,s){t.exports=s.p+"assets/img/waf-securityAutomationtemplate.6dfe342d.png"},379:function(t,a,s){t.exports=s.p+"assets/img/shieldee.4e48c8a2.png"},533:function(t,a,s){"use strict";s.r(a);var e=s(25),v=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"frontmatter-title"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[t._v("#")]),t._v(" "+t._s(t.$frontmatter.title))]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("목표")]),t._v(" "),e("p",[t._v(t._s(t.$frontmatter.description))])]),t._v(" "),e("h2",{attrs:{id:"a-cloudflare-의-advanced-ddos-를-이용한-방어-전략"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-cloudflare-의-advanced-ddos-를-이용한-방어-전략"}},[t._v("#")]),t._v(" A. Cloudflare 의 Advanced DDoS 를 이용한 방어 전략")]),t._v(" "),e("ol",[e("li",[t._v("봇넷을 통해 공격이 들어오면 데이터베이스에 부하가 발생하고, 서비스 요청이 정상적으로 처리되지 않는다")]),t._v(" "),e("li",[t._v("서비스 운영자는 이를 확인하고 Cloudflare 에서 "),e("strong",[t._v("I'm Under Attack")]),t._v(" 모드를 활성화한다")]),t._v(" "),e("li",[t._v("하지만 언젠가부터 "),e("strong",[t._v("I'm Under Attack")]),t._v(" 을 통과하는 방식의 공격이 발생하였다")]),t._v(" "),e("li",[t._v("이를 방어하기 위해서 "),e("strong",[t._v("Rate Limiting")]),t._v(" 을 사용하여 방어하려고 하였으나, "),e("strong",[t._v("Rate Limit")]),t._v(" 집계 시점 이전에 이미 방대한 요청이 들어오기 때문에, "),e("strong",[t._v("능동 방어에는 시간이 걸린다(1분 이상)")])])]),t._v(" "),e("h2",{attrs:{id:"b-aws-waf-security-automations-template을-이용한-방어-전략"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#b-aws-waf-security-automations-template을-이용한-방어-전략"}},[t._v("#")]),t._v(" B. AWS WAF Security Automations Template을 이용한 방어 전략")]),t._v(" "),e("p",[e("img",{attrs:{src:s(378),alt:""}})]),t._v(" "),e("ol",[e("li",[t._v("봇넷을 통해 공격이 들어오면 데이터베이스에 부하가 발생하고, 서비스 요청이 정상적으로 처리되지 않는다")]),t._v(" "),e("li",[t._v("CloudFront 또는 Application Load Balancer 에서 Access Logs 를 활성화하고, S3에 저장하도록 한다")]),t._v(" "),e("li",[t._v("S3에 Access Log가 적재된 이후에, Amazon Athena 가 해당 로그를 "),e("strong",[t._v("5분 단위로 집계")]),t._v("하여, 지정한 요청 임계치를 초과한 IP들을 AWS WAF IP Set에 추가한다")])]),t._v(" "),e("ul",[e("li",[t._v("마찬가지로 집계 시점 이전에 이미 방대한 요청이 들어오므로, "),e("strong",[t._v("대응이 느리다(5분 이상)")])])]),t._v(" "),e("h2",{attrs:{id:"c-shieldee-의-대응-시나리오"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#c-shieldee-의-대응-시나리오"}},[t._v("#")]),t._v(" C. Shieldee 의 대응 시나리오")]),t._v(" "),e("p",[e("img",{attrs:{src:s(379),alt:""}})]),t._v(" "),e("ol",[e("li",[t._v("봇넷을 통해 공격이 들어오면 앞단 NGINX 에서 지정된 Rate Limiting 정책에 해당하는 개별 IP들을 에러 로그로 떨어뜨린다.")]),t._v(" "),e("li",[t._v("해당 에러 로그를 탐지하자마자 곧바로 엣지 WAF 에 룰셋으로 해당 IP를 블락한다.\n"),e("ul",[e("li",[t._v("엣지 영역에서 블락하지 못한 트래픽들을 위한 최후방어선으로 동작하며,")]),t._v(" "),e("li",[e("strong",[t._v("Rate Limiting 탐지 이후 3초 안에 블락한다.")])])])]),t._v(" "),e("li",[t._v("일시적인 오탐 등을 고려하여 1시간 뒤에 해당 IP들을 해제한다.")])]),t._v(" "),e("h2",{attrs:{id:"_2-동작-방식"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-동작-방식"}},[t._v("#")]),t._v(" 2. 동작 방식")]),t._v(" "),e("ol",[e("li",[t._v("봇넷을 통해 공격이 들어오면, NGINX 의 "),e("strong",[t._v("Rate Limiting")]),t._v(" 기능으로 개별 IP들의 초당 요청 수를 제한하도록 한다\n"),e("ol",[e("li",[t._v("이 때의 "),e("strong",[t._v("Rate Limiting")]),t._v(" 대상은 동적 컨텐츠 요청 영역으로만 한정한다")])])]),t._v(" "),e("li",[e("strong",[t._v("Rate Limiting")]),t._v(" 에 적용된 IP 들은 NGINX 에러 로그 파일로 기록이 된다.")]),t._v(" "),e("li",[e("strong",[t._v("fluentd")]),t._v(" 로 에러 로그를 테일링(Tailing) 하여, "),e("strong",[t._v("Rate Limiting")]),t._v(" 로그 형식에 맞춰서 정규표현식으로 캡처를 한다")]),t._v(" "),e("li",[t._v("캡처된 내용을 "),e("strong",[t._v("Amazon Kinesis Data Streams")]),t._v(" 로 전달하고,")]),t._v(" "),e("li",[e("strong",[t._v("Kinesis Data Streams")]),t._v(" 에서 트리거링된 "),e("strong",[t._v("AWS Lambda")]),t._v(" 가 동작하여, 전달된 IP를 "),e("strong",[t._v("DynamoDB")]),t._v("에 기록한다.")]),t._v(" "),e("li",[t._v("기록된 정보는 "),e("strong",[t._v("DynamoDB Streams")]),t._v(" 로 "),e("strong",[t._v("AWS Lambda")]),t._v(" 에 전달되는데, 이 때 해당 IP를 Cloudflare Access Rule 에 Block 모드로 추가한다\n"),e("ol",[e("li",[t._v("Access Rule 에 추가하고 반환받은 Access Rule Id를 "),e("strong",[t._v("DynamoDB")]),t._v(" 에 기록한다")]),t._v(" "),e("li",[t._v("이 때, "),e("code",[t._v("expirationTime")]),t._v(" 속성을 TTL 로 추가하고, 기본 TTL을 3600(1시간)으로 지정한다.")])])]),t._v(" "),e("li",[e("strong",[t._v("DynamoDB")]),t._v(" 에서 TTL 이 경과된 항목이 삭제되면서, 해당 내용이 "),e("strong",[t._v("DynamoDB Streams")]),t._v(" 을 통해서 "),e("strong",[t._v("AWS Lambda")]),t._v(" 로 트리거링된다.\n"),e("ol",[e("li",[e("strong",[t._v("DynamoDB")]),t._v(" 에 기록된 Access Rule Id 으로 Cloudflare Access Rule 에 등록된 IP를 해제한다")])])])])])}),[],!1,null,null,null);a.default=v.exports}}]);