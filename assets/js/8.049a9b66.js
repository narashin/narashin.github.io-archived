(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{430:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_10.18.07.50bff841.png"},431:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_10.18.30.885097af.png"},432:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_10.18.53.f3826eb9.png"},433:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_10.42.44.b0e67f05.png"},434:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_11.04.31.527000ac.png"},435:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_11.04.43.8b21a892.png"},436:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_11.07.51.44313a97.png"},437:function(t,a,s){t.exports=s.p+"assets/img/cloudtrail-log-to-another-account_11.19.25.f30ced54.png"},549:function(t,a,s){"use strict";s.r(a);var r=s(25),n=Object(r.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"cloudtrail-log를-타-계정의-s3-mfa-delete-에-전송하기"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cloudtrail-log를-타-계정의-s3-mfa-delete-에-전송하기"}},[t._v("#")]),t._v(" CloudTrail Log를 타 계정의 S3(+MFA Delete)에 전송하기")]),t._v(" "),r("h1",{attrs:{id:"_0-시나리오"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_0-시나리오"}},[t._v("#")]),t._v(" 0. 시나리오")]),t._v(" "),r("p",[t._v("(1) A 계정에서 발생하는 CloudTrail Log를 B 계정에 존재하는 S3 Bucket에 담고 싶다.\n(2) 이때 쌓이는 Log 객체들의 버전을 기록한다.\n(3) B계정의 S3 bucket에 담긴 Log 객체에 접근하기 위해서는 MFA가 필요하다.")]),t._v(" "),r("h1",{attrs:{id:"_1-b계정-s3-bucket-설정하기"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-b계정-s3-bucket-설정하기"}},[t._v("#")]),t._v(" 1. B계정 S3 Bucket 설정하기")]),t._v(" "),r("h2",{attrs:{id:"_1-s3-bucket-생성하기"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-s3-bucket-생성하기"}},[t._v("#")]),t._v(" (1) S3 Bucket 생성하기")]),t._v(" "),r("p",[r("img",{attrs:{src:s(430),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_10.18.07.png"}})]),t._v(" "),r("ul",[r("li",[t._v("로그를 쌓을 버킷을 생성한다.")])]),t._v(" "),r("p",[r("img",{attrs:{src:s(431),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_10.18.30.png"}})]),t._v(" "),r("ul",[r("li",[r("code",[t._v("버전 관리")]),t._v(" 부분을 체크한다.")]),t._v(" "),r("li",[t._v("기타 다른 옵션에 대해 필요한 경우 체크한다.")])]),t._v(" "),r("p",[r("img",{attrs:{src:s(432),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_10.18.53.png"}})]),t._v(" "),r("ul",[r("li",[t._v("권한 설정은 이 이후에 세부적으로 진행할 것이기 때문에 일단은 "),r("code",[t._v("다음")]),t._v("을 눌러 버킷 생성을 진행한다.")])]),t._v(" "),r("h2",{attrs:{id:"_2-bucket에-권한-설정-하기"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-bucket에-권한-설정-하기"}},[t._v("#")]),t._v(" (2) Bucket에 권한 설정 하기")]),t._v(" "),r("p",[r("img",{attrs:{src:s(433),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_10.42.44.png"}})]),t._v(" "),r("ul",[r("li",[t._v("1에서 생성한 Bucket의 "),r("code",[t._v("권한")]),t._v(" → "),r("code",[t._v("버킷 정책")]),t._v(" 에서 CloudTrail에 쓰기 권한을 줄 수 있는 정책을 작성한다.\n"),r("ul",[r("li",[t._v("아래 양식 참고")])])])]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Sid"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AWSCloudTrailAclCheck20131101"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Principal"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Service"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cloudtrail.amazonaws.com"')]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3:GetBucketAcl"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:s3:::myBucketName"')]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Sid"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AWSCloudTrailWrite20131101"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Principal"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Service"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cloudtrail.amazonaws.com"')]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3:PutObject"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:s3:::myBucketName/[optional] myLogFilePrefix/AWSLogs/111111111111/*"')]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"StringEquals"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"s3:x-amz-acl"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bucket-owner-full-control"')]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("ul",[r("li",[r("code",[t._v("myBucketName")]),t._v(" 과 "),r("code",[t._v("myLogFilePrefix")]),t._v(" (Optional), "),r("code",[t._v("111111111111")]),t._v(" ("),r("strong",[t._v("A Account Number")]),t._v(") 수정 필요")])]),t._v(" "),r("h1",{attrs:{id:"_2-a계정-cloudtrail-설정하기"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-a계정-cloudtrail-설정하기"}},[t._v("#")]),t._v(" 2. A계정 CloudTrail 설정하기")]),t._v(" "),r("h2",{attrs:{id:"_1-cloudtrail-추적-생성하기"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-cloudtrail-추적-생성하기"}},[t._v("#")]),t._v(" (1) CloudTrail 추적 생성하기")]),t._v(" "),r("p",[r("img",{attrs:{src:s(434),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_11.04.31.png"}})]),t._v(" "),r("p",[r("img",{attrs:{src:s(435),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_11.04.43.png"}})]),t._v(" "),r("ul",[r("li",[t._v("1번 과정에서 생성한 Bucket을 지정. 위에서 접두사(Optional)를 지정했다면 이 또한 명시하여 설정한다.")])]),t._v(" "),r("p",[r("img",{attrs:{src:s(436),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_11.07.51.png"}})]),t._v(" "),r("ul",[r("li",[r("p",[t._v("생성 완료. 몇 분 후 구성이 완료 되면 B계정 Bucket에 A계정의 CloudTrail Log가 쌓이게 된다.")]),t._v(" "),r("p",[r("img",{attrs:{src:s(437),alt:"~@img/cloudtrail-log-to-another-account/cloudtrail-log-to-another-account_11.19.25.png"}})])])]),t._v(" "),r("h1",{attrs:{id:"_3-mfa-설정"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-mfa-설정"}},[t._v("#")]),t._v(" 3. MFA 설정")]),t._v(" "),r("ul",[r("li",[t._v("S3 Bucket에 다음과 같은 "),r("code",[t._v("권한")]),t._v(" → "),r("code",[t._v("버킷 정책")]),t._v("을 추가 한다.")])]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Sid"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MFA"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Principal"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"AWS"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:iam::<Account>:root"')]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3:*"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:s3:::<Bucket-Name>/*"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"BoolIfExists"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aws:MultiFactorAuthPresent"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("ul",[r("li",[r("code",[t._v('"arn:aws:iam::<Account>:root"')]),t._v(" 에 Account 숫자를 정확히 기입")]),t._v(" "),r("li",[r("code",[t._v("Action")]),t._v(" 의 경우 더 세밀한 Action으로 지정 가능")]),t._v(" "),r("li",[r("code",[t._v('"arn:aws:s3:::<Bucket-Name>/*"')]),t._v(" 에 Bucket Name을 정확히 기입")])]),t._v(" "),r("p",[t._v("버킷 소유자, 버킷을 생성한 AWS 계정(루트 계정), 모든 인증된 IAM 사용자는 버전 관리를 활성화할 수 있지만, 버킷 소유자(루트 계정)만 MFA Delete를 활성화할 수 있습니다. 자세한 내용은 MFA 삭제 및 버전 관리에 대한 AWS 블로그 게시물을 참조하십시오.")]),t._v(" "),r("ul",[r("li",[t._v("버저닝과 달리 "),r("strong",[t._v("MFA Delete 기능은 Root 사용자만 활성화")]),t._v(" 시킬 수 있다.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"https://aws.amazon.com/ko/premiumsupport/knowledge-center/enforce-mfa-other-account-access-bucket/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://aws.amazon.com/ko/premiumsupport/knowledge-center/enforce-mfa-other-account-access-bucket/"),r("OutboundLink")],1)]),t._v(" "),r("p",[r("a",{attrs:{href:"https://aws.amazon.com/ko/blogs/security/how-to-enable-mfa-protection-on-your-aws-api-calls/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://aws.amazon.com/ko/blogs/security/how-to-enable-mfa-protection-on-your-aws-api-calls/"),r("OutboundLink")],1)]),t._v(" "),r("ul",[r("li",[t._v("위 링크 참고")])]),t._v(" "),r("p",[r("a",{attrs:{href:"https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/dev/Versioning.html#MultiFactorAuthenticationDelete",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),t._v(" "),r("p",[r("a",{attrs:{href:"https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-7",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),t._v(" "),r("p",[r("a",{attrs:{href:"https://aws.amazon.com/ko/blogs/security/securing-access-to-aws-using-mfa-part-3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Securing Access to AWS Using MFA - Part 3 | Amazon Web Services"),r("OutboundLink")],1)]),t._v(" "),r("p",[r("a",{attrs:{href:"https://aws.amazon.com/ko/premiumsupport/knowledge-center/enforce-mfa-other-account-access-bucket/",target:"_blank",rel:"noopener noreferrer"}},[t._v("다른 계정의 사용자가 내 S3 버킷에 액세스할 때 MFA 적용"),r("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);