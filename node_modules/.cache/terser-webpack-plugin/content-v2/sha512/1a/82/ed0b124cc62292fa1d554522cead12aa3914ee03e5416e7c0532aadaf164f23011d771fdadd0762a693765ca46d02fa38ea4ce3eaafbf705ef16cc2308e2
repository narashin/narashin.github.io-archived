{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{394:function(a,s,t){a.exports=t.p+\"assets/img/6-giphy.9b0c99d3.gif\"},395:function(a,s,t){a.exports=t.p+\"assets/img/1-687474703a2f2f696d67322e72756c697765622e636f6d2f696d672f696d675f6c696e6b372f3530342f3530333031355f362e6a7067.222587a5.jpeg\"},396:function(a,s,t){a.exports=t.p+\"assets/img/2-s5cmd-3a.401b126a.gif\"},397:function(a,s,t){a.exports=t.p+\"assets/img/3-0_80gJDQySaSwU9qWQ.1dd71067.png\"},398:function(a,s,t){a.exports=t.p+\"assets/img/5-2022-07-213.06.47.a8e883e2.png\"},399:function(a,s,t){a.exports=t.p+\"assets/img/4-2021-11-087.23.42.bc4e0e27.png\"},522:function(a,s,t){\"use strict\";t.r(s);var e=t(25),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":a.$parent.slotKey}},[e(\"h1\",{attrs:{id:\"frontmatter-title\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#frontmatter-title\"}},[a._v(\"#\")]),a._v(\" \"+a._s(a.$frontmatter.title))]),a._v(\" \"),e(\"p\",[a._v(\"협력 업체에서 본인들의 데이터를 다운받을 수 있게 getObject 권한을 \"),e(\"strong\",[a._v(\"일시적\")]),a._v(\"으로 주었다. 그것은 단 한달.\")]),a._v(\" \"),e(\"p\",[a._v(\"우리가 받아야 하는 데이터는 평균 6.26MB 크기로, 대략 1000만개 이상의 mp3 파일들이다.\")]),a._v(\" \"),e(\"h1\",{attrs:{id:\"가장-쉬운-방법-srr\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#가장-쉬운-방법-srr\"}},[a._v(\"#\")]),a._v(\" 가장 쉬운 방법 SRR\")]),a._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(394),alt:\"giphy.gif\"}})]),a._v(\" \"),e(\"p\",[a._v(\"SRR은 동일 리전 복제(Same Region Replication)의 줄임말로 AWS에서 정식으로 지원하고 있는 기능이다. 새로 업로드된 S3 객체를 동일한 AWS 리전에서 대상 버킷으로 비동기식 자동 복제를 지원한다.\")]),a._v(\" \"),e(\"p\",[a._v(\"이 때까지만 해도 데이터가 실시간으로 올라오고 우리는 실시간 sync에 가깝게 bucket을 \"),e(\"strong\",[a._v(\"복사\")]),a._v(\"한다고 착각했기 때문에 가장 먼저 떠오른 방법이다. 하지만 신작을 copy하는 것이 아닌 구작을 뒤늦게 받아오는 작업이었고 다른 방법이 필요했다.\")]),a._v(\" \"),e(\"h2\",{attrs:{id:\"😵-새로-올라오는-데이터가-아닌데\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#😵-새로-올라오는-데이터가-아닌데\"}},[a._v(\"#\")]),a._v(\" 😵 새로 올라오는 데이터가 아닌데?\")]),a._v(\" \"),e(\"p\",[a._v(\"(물론 교차 계정 SRR에도 권한 조정 문제가 필요하지만) SRR을 쓰지 않고 버킷에서 버킷으로 copy를 하려고 한다면, 소스 버킷의 Bucket policy에서 데스티네이션 버킷에 권한을 따로 풀어주는 선언문이 필요했다.\")]),a._v(\" \"),e(\"p\",[a._v('하지만 소스 버킷의 bucket policy 는 우리가 건드릴 수 있는 영역이 아니었다. (이부분에서 안일하게 생각했던 것이, 과거 경험에서는 \"제가 말한대로 바꿔야 가격효율적입니다.\"라고 말하면 바로 바꿔주는 고객을 많이 만났기 때문에 당연히 bucket policy도 쉽게 바꿀 수 있을 것이라고 생각했다.)')]),a._v(\" \"),e(\"h3\",{attrs:{id:\"우리가-건드릴-수-있는-영역-권한-이-아닌데\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#우리가-건드릴-수-있는-영역-권한-이-아닌데\"}},[a._v(\"#\")]),a._v(\" + 우리가 건드릴 수 있는 영역~권한~이 아닌데?\")]),a._v(\" \"),e(\"p\",[a._v(\"권한을 조정하면 bucket에서 bucket으로 직접 전송이 가능하기 때문에 불필요한 단계를 많이 건너뛸 수 있는데, 이를 할 수 없게 되었으니 다른 방법을 강구해야 했다.\")]),a._v(\" \"),e(\"h1\",{attrs:{id:\"charon\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#charon\"}},[a._v(\"#\")]),a._v(\" Charon\")]),a._v(\" \"),e(\"p\",[a._v(\"Ralph가 Boto3를 이용하여 만든 Worker\")]),a._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(395),alt:\"687474703a2f2f696d67322e72756c697765622e636f6d2f696d672f696d675f6c696e6b372f3530342f3530333031355f362e6a7067.jpeg\"}})]),a._v(\" \"),e(\"p\",[a._v(\"이미 위와 같은 여러 좌절적인 케이스를 경험한 랄프는 S3 Import를 도와줄 워커를 직접 만들기로 결심한 것 같았다. (내가 팀에 합류한 이후에도 한번더 더 쉬운 방법이 없는지 물어보셨지만, 본인이 리서치한 결과와 크게 다르지 않아서 많이 실망하셨을 것 같다.)\")]),a._v(\" \"),e(\"p\",[a._v(\"그리고 랄프가 만든 카론이 열심히 S3 Import 작업을 하고 있었다.\")]),a._v(\" \"),e(\"ul\",[e(\"li\",[a._v(\"Python\")]),a._v(\" \"),e(\"li\",[a._v(\"pod에서 작동중 (m5.xlarge)\")]),a._v(\" \"),e(\"li\",[a._v(\"import 속도 : 1초 약 1.3개\")])]),a._v(\" \"),e(\"p\",[a._v(\"하지만 카론의 속도로는 24시간 풀로 돌아가도, 모든 파일을 받아오는 데에 대략 \"),e(\"em\",[a._v(\"90여일\")]),a._v(\"이 걸려 마감기한까지 데이터를 모두 받아올 수 없는 상황이었다.\")]),a._v(\" \"),e(\"p\",[a._v(\"python 으로 되어있는 boto3와, 워커가 올라가 있는 인스턴스의 네트워크 대역폭이 가장 큰 한계점이라고 생각했다.\")]),a._v(\" \"),e(\"h1\",{attrs:{id:\"s5cmd\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#s5cmd\"}},[a._v(\"#\")]),a._v(\" s5cmd\")]),a._v(\" \"),e(\"p\",[a._v(\"이 때 떠오른 것이 s5cmd 이다. go로 만들어져있고 여러 tcp 연결을 더 잘 활용하여 개체 저장소로 더 많은 데이터를 전송하여 매우 빠르다는 \"),e(\"a\",{attrs:{href:\"https://joshua-robinson.medium.com/s5cmd-for-high-performance-object-storage-7071352cc09d\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a._v(\"벤치마크 포스팅\"),e(\"OutboundLink\")],1),a._v(\"을 본 기억이 나서 이를 차용해보기로 했다.\")]),a._v(\" \"),e(\"p\",[e(\"a\",{attrs:{href:\"https://aws.amazon.com/ko/blogs/opensource/parallelizing-s3-workloads-s5cmd/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a._v(\"Parallelizing S3 Workloads with s5cmd | Amazon Web Services\"),e(\"OutboundLink\")],1)]),a._v(\" \"),e(\"h2\",{attrs:{id:\"사용법\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#사용법\"}},[a._v(\"#\")]),a._v(\" 사용법\")]),a._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(396),alt:\"s5cmd-3a.gif\"}})]),a._v(\" \"),e(\"p\",[a._v(\"사용법은 간단하다. golang을 먼저 설치하고, s5cmd를 설치.\")]),a._v(\" \"),e(\"div\",{staticClass:\"language-bash extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[e(\"code\",[a._v(\"go get -u github.com/peakgames/s5cmd\\n\")])])]),e(\"p\",[a._v(\"s3를 이용할 AWS 계정의 Credentials file을 작성한다. \"),e(\"code\",[a._v(\"~/.aws/credetials\")])]),a._v(\" \"),e(\"div\",{staticClass:\"language-bash extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"[\")]),a._v(\"default\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"]\")]),a._v(\"\\naws_access_key_id \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\" XXXXXXX\\naws_secret_access_key \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\" YYYYYYYY\\n\")])])]),e(\"h3\",{attrs:{id:\"다운로드\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#다운로드\"}},[a._v(\"#\")]),a._v(\" 다운로드\")]),a._v(\" \"),e(\"p\",[e(\"strong\",[a._v(\"하나의 파일을 받을 때\")])]),a._v(\" \"),e(\"div\",{staticClass:\"language-bash extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[e(\"code\",[a._v(\"s5cmd \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[a._v(\"cp\")]),a._v(\" s3://prod-wmg-s3delivery/DSP_7804/20210925132945877/ \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[a._v(\".\")]),a._v(\"\\n\")])])]),e(\"p\",[e(\"strong\",[a._v(\"여러개 파일을 받을 때\")])]),a._v(\" \"),e(\"div\",{staticClass:\"language-bash extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[e(\"code\",[a._v(\"s3://prod-wmg-s3delivery/DSP_7804/20210925132945877/\\ns3://prod-wmg-s3delivery/DSP_7804/20210925132945234/\\ns3://prod-wmg-s3delivery/DSP_7804/20210925132342137/\\n\")])])]),e(\"p\",[a._v(\"와일드카드를 쓸 수 있다.\")]),a._v(\" \"),e(\"div\",{staticClass:\"language-bash extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[e(\"code\",[a._v(\"s5cmd \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[a._v(\"cp\")]),a._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v(\"'s3://prod-wmg-s3delivery/DSP_7804/2021092513*'\")]),a._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[a._v(\".\")]),a._v(\"\\n\")])])]),e(\"h3\",{attrs:{id:\"업로드\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#업로드\"}},[a._v(\"#\")]),a._v(\" 업로드\")]),a._v(\" \"),e(\"p\",[e(\"strong\",[a._v(\"하나의 파일만 올릴 때\")])]),a._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[a._v(\"s5cmd cp object.gz s3://music-distributor/wmg/New\\\\ Release/\\n\\n\")])])]),e(\"p\",[e(\"strong\",[a._v(\"여러개 파일을 올릴 때\")])]),a._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[a._v(\"/s5cmd cp '20210925*' s3://music-distributor/wmg/New\\\\ Release/\\n\\n\")])])]),e(\"h3\",{attrs:{id:\"주의할-점\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#주의할-점\"}},[a._v(\"#\")]),a._v(\" 주의할 점\")]),a._v(\" \"),e(\"p\",[a._v(\"이미 작업을 할 EC2 Instance에 데스티네이션 bucket에 대한 Role이 지정되어 있으므로, 인스턴스 내에서 \"),e(\"code\",[a._v(\"aws configure\")]),a._v(\" 를 통해 credentials값을 재정의하면 EC2 Role이 덮어씌워짐.\")]),a._v(\" \"),e(\"h2\",{attrs:{id:\"결과\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#결과\"}},[a._v(\"#\")]),a._v(\" 결과\")]),a._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(397),alt:\"0_80gJDQySaSwU9qWQ.png\"}})]),a._v(\" \"),e(\"blockquote\",[e(\"p\",[a._v(\"우리가 받아야 하는 데이터는 평균 6.26MB 크기로, 대략 1000만개 이상의 mp3 파일들이다.\")])]),a._v(\" \"),e(\"ul\",[e(\"li\",[a._v(\"Import 속도 :\\n\"),e(\"ul\",[e(\"li\",[a._v(\"(로컬) 1초 약 2.25개\")])])])]),a._v(\" \"),e(\"h3\",{attrs:{id:\"c5n-xlarge-네트워크-대역폭이-큰-인스턴스-사용\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#c5n-xlarge-네트워크-대역폭이-큰-인스턴스-사용\"}},[a._v(\"#\")]),a._v(\" c5n.xlarge - 네트워크 대역폭이 큰 인스턴스 사용\")]),a._v(\" \"),e(\"p\",[a._v(\"회사에서 지급해준 맥북프로(i9 8core, 32GB)로 회사 네트워크를 사용하여 s5cmd를 통해 S3 Import를 할 때 걸린 시간은 초당 2.25개로 카론의 속도보다 약 2배 빨라졌음을 알 수 있었다. s5cmd의 성능이 로컬 테스트를 통해 어느정도 입증이 되어, 이를 더 좋은 환경에서 구동시켜 효율을 극대화 시키고자 했다.\")]),a._v(\" \"),e(\"p\",[a._v(\"기존 카론이 돌아가는 m5.xlarge 사양의 pod이 아닌 네트워크 대역폭이 훨씬 큰 인스턴스를 사용하면 어떻게 될까?\")]),a._v(\" \"),e(\"h4\",{attrs:{id:\"m5-xlarge-vs-c5n-xlarge\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#m5-xlarge-vs-c5n-xlarge\"}},[a._v(\"#\")]),a._v(\" m5.xlarge vs. c5n.xlarge\")]),a._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(398),alt:\"\"}})]),a._v(\" \"),e(\"blockquote\",[e(\"p\",[a._v(\"C5n의 ENI(탄력적 네트워크 인터페이스)는 최대 32개의 대기열(C5 및 C5d의 경우 8개)을 사용을 통해 모든 vCPU들에 더욱 효율적으로 분산되는 패킷 처리 워크로드를 가능하게 합니다.\")])]),a._v(\" \"),e(\"ul\",[e(\"li\",[a._v(\"Import 속도\\n\"),e(\"ul\",[e(\"li\",[a._v(\"(c5n.xlarge) 1초 약 11.48개\")])])])]),a._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(399),alt:\"스크린샷 2021-11-08 오전 7.23.42.png\"}})]),a._v(\" \"),e(\"p\",[a._v(\"S3 Import 속도가 비약적으로 증가했다. Charon 을 이용 했을 때보다 \"),e(\"strong\",[a._v(\"약 8.8배\")]),a._v(\" 속도 증가를 체감할 수 있었다.\")]),a._v(\" \"),e(\"p\",[a._v(\"현재는 c5n.xlarge 인스턴스 2대를 이용하여 S3 Import 작업을 계속하고 있으며, 작업 착수일인 11월 2일부터 지금까지 약 376만여개의 객체를 받아올 수 있었다.\")])])}),[],!1,null,null,null);s.default=r.exports}}]);","extractedComments":[]}