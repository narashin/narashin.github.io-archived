{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{428:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__12.04.04.8cf70fd5.png\"},429:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.20.44.96356c02.png\"},430:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.20.51.4c4ec25c.png\"},431:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.21.10.45e3c039.png\"},432:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.21.19.06b2da8f.png\"},433:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.21.42.b4325114.png\"},434:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.21.48.7d4f1c09.png\"},435:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__10.22.00.1a35f21a.png\"},436:function(t,s,a){t.exports=a.p+\"assets/img/_2020-09-07__11.52.33.f580cc1c.png\"},493:function(t,s,a){\"use strict\";a.r(s);var n=a(25),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"aws-glue로-crawling한-데이터가-athena에서-zero-record로-인식된다\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aws-glue로-crawling한-데이터가-athena에서-zero-record로-인식된다\"}},[t._v(\"#\")]),t._v(\" AWS Glue로 Crawling한 데이터가 Athena에서 Zero Record로 인식된다\")]),t._v(\" \"),n(\"h1\",{attrs:{id:\"_1-문제상황\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-문제상황\"}},[t._v(\"#\")]),t._v(\" 1. 문제상황\")]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(428),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__12.04.04.png\"}})]),t._v(\" \"),n(\"p\",[t._v(\"AWS Glue를 이용하여 S3의 데이터를 크롤링 하여 Athena 테이블을 생성시 데이터의 스키마는 제대로 로드됐으나, \"),n(\"code\",[t._v(\"Zero record\")]),t._v(\" 를 반환하는 경우가 발생하였다.\")]),t._v(\" \"),n(\"h1\",{attrs:{id:\"_2-문제원인\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-문제원인\"}},[t._v(\"#\")]),t._v(\" 2. 문제원인\")]),t._v(\" \"),n(\"p\",[n(\"a\",{attrs:{href:\"https://aws.amazon.com/ko/premiumsupport/knowledge-center/athena-empty-results/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"빈 결과값을 반환하는 Amazon Athena 쿼리 문제 해결\"),n(\"OutboundLink\")],1)]),t._v(\" \"),n(\"p\",[t._v(\"대체로 위의 상황에서 문제가 발생한다.\")]),t._v(\" \"),n(\"h1\",{attrs:{id:\"_3-해결방법\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-해결방법\"}},[t._v(\"#\")]),t._v(\" 3. 해결방법\")]),t._v(\" \"),n(\"h2\",{attrs:{id:\"_1-aws-glue-에서-데이터-카탈로그-생성\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-aws-glue-에서-데이터-카탈로그-생성\"}},[t._v(\"#\")]),t._v(\" (1) AWS Glue 에서 데이터 카탈로그 생성\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"가-크롤러-생성\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#가-크롤러-생성\"}},[t._v(\"#\")]),t._v(\" 가. 크롤러 생성\")]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(429),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.20.44.png\"}})]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(430),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.20.51.png\"}})]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(431),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.21.10.png\"}})]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(432),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.21.19.png\"}})]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"이렇게 특정 오브젝트를 선택하지 말고 상위 폴더 또는 버킷으로 지정\")]),t._v(\" \"),n(\"li\",[t._v('이때 S3의 포함 경로를 내가 크롤링 하고 싶은 특정 오브젝트가 아닌 \"경로\"만 지정한다.\\n'),n(\"ul\",[n(\"li\",[t._v(\"경로를 지정할 때는 마지막에 \"),n(\"code\",[t._v(\"/\")]),t._v(\" 슬래쉬로 꼭 닫아준다.\")])])])]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(433),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.21.42.png\"}})]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"IAM 롤의 경우, Bucket 마다 새 역할을 부여하므로 기존에 썼던 IAM이 아니라, 새 버킷에는 새 IAM롤을 생성할 수 있도록 한다.\")])]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(434),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.21.48.png\"}})]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"일정은 원하는대로 지정\")])]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(435),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__10.22.00.png\"}})]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"Athena의 어떤 데이터베이스에 테이블을 만들지 지정\")])]),t._v(\" \"),n(\"h3\",{attrs:{id:\"나-athena의-데이터베이스-및-테이블-확인\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#나-athena의-데이터베이스-및-테이블-확인\"}},[t._v(\"#\")]),t._v(\" 나. Athena의 데이터베이스 및 테이블 확인\")]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(436),alt:\"~@img/glue-crawled-data-zeroRecord/_2020-09-07__11.52.33.png\"}})]),t._v(\" \"),n(\"div\",{staticClass:\"language-sql extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-sql\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"CREATE\")]),t._v(\" EXTERNAL \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"TABLE\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\"nara\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\"account_name\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\" string\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\"account_id\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"bigint\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"year\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"bigint\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"month\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"bigint\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\"yyyymmdd\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"`\")]),t._v(\" string\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"ROW\")]),t._v(\" FORMAT DELIMITED\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"FIELDS\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"TERMINATED\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"BY\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'\\\\t'\")]),t._v(\"\\nSTORED \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"AS\")]),t._v(\" INPUTFORMAT\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'org.apache.hadoop.mapred.TextInputFormat'\")]),t._v(\"\\nOUTPUTFORMAT\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'\")]),t._v(\"\\nLOCATION\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'s3://mzc-mbr-test/nara/'\")]),t._v(\"\\nTBLPROPERTIES \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'CrawlerSchemaDeserializerVersion'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'1.0'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'CrawlerSchemaSerializerVersion'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'1.0'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'UPDATED_BY_CRAWLER'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'mbr-test'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'areColumnsQuoted'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'false'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'averageRecordSize'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'319'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'classification'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'csv'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'columnsOrdered'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'true'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'compressionType'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'none'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'delimiter'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'\\\\t'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'objectCount'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'recordCount'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'1965'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'sizeKey'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'627001'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'skip.header.line.count'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'typeOfData'\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'file'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),n(\"ul\",[n(\"li\",[t._v(\"문제가 발생한 테이블의 DDL 쿼리를 살펴보면 LOCATION 값이 아래와 같이 특정 오브젝트를 바라볼 가능성이 높다.\")])]),t._v(\" \"),n(\"div\",{staticClass:\"language-sql extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-sql\"}},[n(\"code\",[t._v(\"LOCATION\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'s3://mzc-mbr-test/nara/2020-08.tsv'\")]),t._v(\"\\n\")])])]),n(\"p\",[t._v(\"문제 해결을 위해, 아래와 같은 환경을 조성한다.\")]),t._v(\" \"),n(\"ol\",[n(\"li\",[t._v(\"S3 버킷에는 크롤링 할 Object만 넣어둘 것\\n\"),n(\"ul\",[n(\"li\",[t._v(\"크롤링할 문서와 다른 스키마의 같은 버킷에 두지 말 것.\")]),t._v(\" \"),n(\"li\",[n(\"strong\",[t._v(\"Athena Query문 또한 같은 Bucket에 넣지 말고 다른 Bucket에 따로 보관할 것.\")])])])]),t._v(\" \"),n(\"li\",[t._v(\"S3 Bucket Path를 지정할 때는 마지막에도 \"),n(\"code\",[t._v(\"/\")]),t._v(\" 슬래쉬를 붙여서 Path를 완성시킬 것\")]),t._v(\" \"),n(\"li\",[t._v(\"S3 Bucket에 Glue가 접근할 수 있는 적절한 IAM롤을 지정할 것\")])])])}),[],!1,null,null,null);s.default=r.exports}}]);","extractedComments":[]}