(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{454:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_12.04.04.8cf70fd5.png"},455:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.20.44.96356c02.png"},456:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.20.51.4c4ec25c.png"},457:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.21.10.45e3c039.png"},458:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.21.19.06b2da8f.png"},459:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.21.42.b4325114.png"},460:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.21.48.7d4f1c09.png"},461:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_10.22.00.1a35f21a.png"},462:function(t,a,s){t.exports=s.p+"assets/img/glue-crawled-data-zeroRecord_11.52.33.f580cc1c.png"},536:function(t,a,s){"use strict";s.r(a);var e=s(25),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"aws-glue로-crawling한-데이터가-athena에서-zero-record로-인식된다"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aws-glue로-crawling한-데이터가-athena에서-zero-record로-인식된다"}},[t._v("#")]),t._v(" AWS Glue로 Crawling한 데이터가 Athena에서 Zero Record로 인식된다")]),t._v(" "),e("h1",{attrs:{id:"_1-문제상황"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-문제상황"}},[t._v("#")]),t._v(" 1. 문제상황")]),t._v(" "),e("p",[e("img",{attrs:{src:s(454),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_12.04.04.png"}})]),t._v(" "),e("p",[t._v("AWS Glue를 이용하여 S3의 데이터를 크롤링 하여 Athena 테이블을 생성시 데이터의 스키마는 제대로 로드됐으나, "),e("code",[t._v("Zero record")]),t._v(" 를 반환하는 경우가 발생하였다.")]),t._v(" "),e("h1",{attrs:{id:"_2-문제원인"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-문제원인"}},[t._v("#")]),t._v(" 2. 문제원인")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://aws.amazon.com/ko/premiumsupport/knowledge-center/athena-empty-results/",target:"_blank",rel:"noopener noreferrer"}},[t._v("빈 결과값을 반환하는 Amazon Athena 쿼리 문제 해결"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("대체로 위의 상황에서 문제가 발생한다.")]),t._v(" "),e("h1",{attrs:{id:"_3-해결방법"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-해결방법"}},[t._v("#")]),t._v(" 3. 해결방법")]),t._v(" "),e("h2",{attrs:{id:"_1-aws-glue-에서-데이터-카탈로그-생성"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-aws-glue-에서-데이터-카탈로그-생성"}},[t._v("#")]),t._v(" (1) AWS Glue 에서 데이터 카탈로그 생성")]),t._v(" "),e("h3",{attrs:{id:"가-크롤러-생성"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#가-크롤러-생성"}},[t._v("#")]),t._v(" 가. 크롤러 생성")]),t._v(" "),e("p",[e("img",{attrs:{src:s(455),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.20.44.png"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(456),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.20.51.png"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(457),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.21.10.png"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(458),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.21.19.png"}})]),t._v(" "),e("ul",[e("li",[t._v("이렇게 특정 오브젝트를 선택하지 말고 상위 폴더 또는 버킷으로 지정")]),t._v(" "),e("li",[t._v('이때 S3의 포함 경로를 내가 크롤링 하고 싶은 특정 오브젝트가 아닌 "경로"만 지정한다.\n'),e("ul",[e("li",[t._v("경로를 지정할 때는 마지막에 "),e("code",[t._v("/")]),t._v(" 슬래쉬로 꼭 닫아준다.")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(459),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.21.42.png"}})]),t._v(" "),e("ul",[e("li",[t._v("IAM 롤의 경우, Bucket 마다 새 역할을 부여하므로 기존에 썼던 IAM이 아니라, 새 버킷에는 새 IAM롤을 생성할 수 있도록 한다.")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(460),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.21.48.png"}})]),t._v(" "),e("ul",[e("li",[t._v("일정은 원하는대로 지정")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(461),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_10.22.00.png"}})]),t._v(" "),e("ul",[e("li",[t._v("Athena의 어떤 데이터베이스에 테이블을 만들지 지정")])]),t._v(" "),e("h3",{attrs:{id:"나-athena의-데이터베이스-및-테이블-확인"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#나-athena의-데이터베이스-및-테이블-확인"}},[t._v("#")]),t._v(" 나. Athena의 데이터베이스 및 테이블 확인")]),t._v(" "),e("p",[e("img",{attrs:{src:s(462),alt:"~@img/glue-crawled-data-zeroRecord/glue-crawled-data-zeroRecord_11.52.33.png"}})]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" EXTERNAL "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("nara"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("account_name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("account_id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("year")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("month")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("yyyymmdd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ROW")]),t._v(" FORMAT DELIMITED\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FIELDS")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TERMINATED")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nSTORED "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" INPUTFORMAT\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.apache.hadoop.mapred.TextInputFormat'")]),t._v("\nOUTPUTFORMAT\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'")]),t._v("\nLOCATION\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s3://mzc-mbr-test/nara/'")]),t._v("\nTBLPROPERTIES "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CrawlerSchemaDeserializerVersion'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.0'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CrawlerSchemaSerializerVersion'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.0'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UPDATED_BY_CRAWLER'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mbr-test'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'areColumnsQuoted'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'false'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'averageRecordSize'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'319'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classification'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'csv'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'columnsOrdered'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'compressionType'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'delimiter'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'objectCount'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'recordCount'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1965'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sizeKey'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'627001'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'skip.header.line.count'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'typeOfData'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("ul",[e("li",[t._v("문제가 발생한 테이블의 DDL 쿼리를 살펴보면 LOCATION 값이 아래와 같이 특정 오브젝트를 바라볼 가능성이 높다.")])]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[t._v("LOCATION\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s3://mzc-mbr-test/nara/2020-08.tsv'")]),t._v("\n")])])]),e("p",[t._v("문제 해결을 위해, 아래와 같은 환경을 조성한다.")]),t._v(" "),e("ol",[e("li",[t._v("S3 버킷에는 크롤링 할 Object만 넣어둘 것\n"),e("ul",[e("li",[t._v("크롤링할 문서와 다른 스키마의 같은 버킷에 두지 말 것.")]),t._v(" "),e("li",[e("strong",[t._v("Athena Query문 또한 같은 Bucket에 넣지 말고 다른 Bucket에 따로 보관할 것.")])])])]),t._v(" "),e("li",[t._v("S3 Bucket Path를 지정할 때는 마지막에도 "),e("code",[t._v("/")]),t._v(" 슬래쉬를 붙여서 Path를 완성시킬 것")]),t._v(" "),e("li",[t._v("S3 Bucket에 Glue가 접근할 수 있는 적절한 IAM롤을 지정할 것")])])])}),[],!1,null,null,null);a.default=r.exports}}]);