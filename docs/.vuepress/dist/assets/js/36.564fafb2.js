(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{474:function(s,a,t){s.exports=t.p+"assets/img/s3-bucket-size_2.31.51.bd088a9d.png"},543:function(s,a,t){"use strict";t.r(a);var r=t(25),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),r("p",[s._v("bucket 사이즈가 너무 클 경우 || 객체가 많은 경우에 스크립트가 돌아가는 데에 한참 걸릴 것으로 예상됨( . .)")])]),s._v(" "),r("h1",{attrs:{id:"계정-내-모든-s3-bucket의-사이즈와-객체-수를-구하는-스크립트"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#계정-내-모든-s3-bucket의-사이즈와-객체-수를-구하는-스크립트"}},[s._v("#")]),s._v(" 계정 내 모든 S3 Bucket의 사이즈와 객체 수를 구하는 스크립트")]),s._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("aws_profile")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'awscli프로필'")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'awscli프로필2'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#loop AWS profiles")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${aws_profile"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v('"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v('"')]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("buckets")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token variable"}},[r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("aws --profile "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v('"')]),s._v(" --region "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("사용하는리전"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" s3 "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" s3:// --recursive "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#loop S3 buckets")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("j")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${buckets"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v('"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${j}")]),s._v('"')]),s._v("\n  aws --profile "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v('"')]),s._v(" --region "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("사용하는리전"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" s3 "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" s3://"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${j}")]),s._v('"')]),s._v(" --recursive --human-readable --summarize "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{ array[NR]="),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" } END { for (i=NR-1; i<=NR; i++) print array[i] }'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),r("ol",[r("li",[r("p",[s._v("AWS CLI 에 저장된 프로필을 긁고")])]),s._v(" "),r("li",[r("p",[s._v("프로필에 생성된 버킷 리스트를 긁고")])]),s._v(" "),r("li",[r("p",[s._v("해당 버킷 내의 객체의 수와 사이즈를 프린트합니다.")]),s._v(" "),r("p",[r("code",[s._v('aws --profile "${i}" --region <사용하는리전> s3 ls s3://"${j}" --recursive --human-readable --summarize | awk \'{ array[NR]=$0 } END { for (i=NR-1; i<=NR; i++) print array[i] }\'')]),s._v(" 에서 "),r("code",[s._v("awk '{ array[NR]=$0 } END { for (i=NR-1; i<=NR; i++) print array[i] }'")]),s._v(" 를 삭제하면 버킷내 모든 객체 정보까지 얻을 수 있습니다.")])])]),s._v(" "),r("p",[r("img",{attrs:{src:t(474),alt:"~@img/s3-bucket-size/s3-bucket-size_2.31.51.png"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);